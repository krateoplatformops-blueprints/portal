apiVersion: widgets.templates.krateo.io/v1beta1
kind: PieChart
metadata:
  name: dashboard-compositions-panel-row-piechart
  namespace: {{ .Release.Namespace }}
  annotations:
    "krateo.io/verbose": "true"
spec:
  widgetData:
    description: Compositions
    series:
      data: []
      total: 0
    title: "0"
  widgetDataTemplate:
    - forPath: series.data
      expression: >
        ${
          [
            {
              color: "green",
              value: ( .list
                | map(select((.status.conditions // [])
                  | map(select(.type == "Ready" and .status == "True"))
                  | length > 0))
                | length),
              label: "Ready:True"
            },
            {
              color: "orange",
              value: ( .list
                | map(select((.status.conditions // [])
                  | map(select(.type == "Ready" and .status == "False"))
                  | length > 0))
                | length),
              label: "Ready:False"
            },
            {
              color: "gray",
              value: ( .list
                | map(select((.status.conditions // [])
                  | map(select(.type == "Ready" and (.status == "True" or .status == "False")))
                  | length == 0))
                | length),
              label: "Unknown"
            }
          ]
        }
    - forPath: series.total
      expression: ${ .list | length }
    - forPath: title
      expression: ${ .list | length | tostring }
  apiRef:
    name: compositions-list
    namespace: {{ .Release.Namespace }}